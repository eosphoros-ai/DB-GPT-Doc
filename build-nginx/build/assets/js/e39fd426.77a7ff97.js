"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6166],{2133:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>p});var o=n(4848),r=n(8453);const s={},a="Multi-Round Chat with LLMs",i={id:"awel/cookbook/multi_round_chat_withllm",title:"Multi-Round Chat with LLMs",description:"In this example, we will show how to use the AWEL library to create a multi-round chat",source:"@site/docs/awel/cookbook/multi_round_chat_withllm.md",sourceDirName:"awel/cookbook",slug:"/awel/cookbook/multi_round_chat_withllm",permalink:"/docs/latest/awel/cookbook/multi_round_chat_withllm",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"QuickStart Basic AWEL Workflow",permalink:"/docs/latest/awel/cookbook/quickstart_basic_awel_workflow"},next:{title:"RAG With AWEL",permalink:"/docs/latest/awel/cookbook/first_rag_with_awel"}},l={},p=[];function c(e){const t={code:"code",h1:"h1",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h1,{id:"multi-round-chat-with-llms",children:"Multi-Round Chat with LLMs"}),"\n",(0,o.jsx)(t.p,{children:"In this example, we will show how to use the AWEL library to create a multi-round chat\nwith a LLM."}),"\n",(0,o.jsxs)(t.p,{children:["Create a python file ",(0,o.jsx)(t.code,{children:"multi_round_chat_with_llm.py"})," and write the following content:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-python",children:'import asyncio\nfrom dbgpt.core.awel import DAG, MapOperator, BaseOperator\nfrom dbgpt.core import (\n    ChatPromptTemplate,\n    HumanPromptTemplate,\n    InMemoryStorage,\n    MessagesPlaceholder,\n    ModelRequestContext,\n    SystemPromptTemplate,\n)\nfrom dbgpt.core.operators import (\n    ChatComposerInput,\n    ChatHistoryPromptComposerOperator,\n)\nfrom dbgpt.model.proxy import OpenAILLMClient\nfrom dbgpt.model.operators import LLMOperator\n\nwith DAG("multi_round_chat_with_lll_dag") as dag:\n    prompt = ChatPromptTemplate(\n        messages=[\n            SystemPromptTemplate.from_template("You are a helpful chatbot."),\n            MessagesPlaceholder(variable_name="chat_history"),\n            HumanPromptTemplate.from_template("{user_input}"),\n        ]\n    )\n\n    composer_operator = ChatHistoryPromptComposerOperator(\n        prompt_template=prompt,\n        keep_end_rounds=5,\n        storage=InMemoryStorage(),\n        message_storage=InMemoryStorage(),\n    )\n    \n    input_task = MapOperator(\n        lambda req: ChatComposerInput(\n            context=ModelRequestContext(conv_uid=req["conv_uid"]),\n            prompt_dict={"user_input": req["user_input"]},\n            model_dict={"model": "gpt-3.5-turbo"},\n        )\n    )\n\n    # Use LLMOperator to generate response.\n    llm_task = LLMOperator(task_name="llm_task", llm_client=OpenAILLMClient())\n    out_parse_task = MapOperator(lambda out: out.text)\n    \n    input_task >> composer_operator >> llm_task >> out_parse_task\n\n\nasync def main(task: BaseOperator):\n    conv_uid = "conv_1234"\n    first_user_input = "Who is elon musk?"\n    second_user_input = "Is he rich?"\n    \n    print(f"First round\\nUser: {first_user_input}")\n    first_ai_response = await task.call({"conv_uid": conv_uid, "user_input": first_user_input})\n    print(f"AI: {first_ai_response}")\n    \n    print(f"\\nSecond round\\nUser: {second_user_input}")\n    second_ai_response = await task.call({"conv_uid": conv_uid, "user_input": second_user_input})\n    print(f"AI: {second_ai_response}")\n\nasyncio.run(main(out_parse_task))\n'})}),"\n",(0,o.jsx)(t.p,{children:"Then run the file with the following command:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"python multi_round_chat_with_llm.py\n"})}),"\n",(0,o.jsx)(t.p,{children:"And you will see the following output:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-plaintext",children:"First round\nUser: Who is elon musk?\nAI: Elon Musk is a well-known entrepreneur and business magnate. He is the CEO and founder of SpaceX, Tesla Inc., Neuralink, and The Boring Company. Musk is known for his work in the technology and space industries, and he is also involved in the development of electric vehicles, renewable energy, and artificial intelligence.\n\nSecond round\nUser: Is he rich?\nAI: Yes, Elon Musk is one of the richest people in the world. As the CEO and founder of multiple successful companies, including SpaceX and Tesla, his net worth fluctuates but is consistently in the billions of dollars.\n"})})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>i});var o=n(6540);const r={},s=o.createContext(r);function a(e){const t=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),o.createElement(s.Provider,{value:t},e.children)}}}]);