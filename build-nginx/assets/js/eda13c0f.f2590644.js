"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8054],{3120:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var n=r(4848),i=r(8453);const o={},a="3.1 Http Trigger",l={id:"awel/awel_tutorial/network_program/3.1_http_trigger",title:"3.1 Http Trigger",description:"Introduction",source:"@site/versioned_docs/version-v0.5.0/awel/awel_tutorial/network_program/3.1_http_trigger.md",sourceDirName:"awel/awel_tutorial/network_program",slug:"/awel/awel_tutorial/network_program/3.1_http_trigger",permalink:"/docs/v0.5.0/awel/awel_tutorial/network_program/3.1_http_trigger",draft:!1,unlisted:!1,tags:[],version:"v0.5.0",frontMatter:{},sidebar:"docs",previous:{title:"2.8 Input Operator",permalink:"/docs/v0.5.0/awel/awel_tutorial/basic_syntax/2.8_input_operator"},next:{title:"3.2 Handling GET Requests",permalink:"/docs/v0.5.0/awel/awel_tutorial/network_program/3.2_http_trigger_get"}},s={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Installation",id:"installation",level:2},{value:"First HTTP Trigger",id:"first-http-trigger",level:2},{value:"How It Works",id:"how-it-works",level:2}];function c(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"31-http-trigger",children:"3.1 Http Trigger"}),"\n",(0,n.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,n.jsx)(t.p,{children:"In this chapter, we will start to focus on how to use AWEL to develop a network program.\nFirst, we will create a simple HTTP trigger that receives a request and returns a response."}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"HttpTrigger"})," is a special ",(0,n.jsx)(t.code,{children:"InputOperator"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"installation",children:"Installation"}),"\n",(0,n.jsxs)(t.p,{children:["We have already created a project named ",(0,n.jsx)(t.code,{children:"awel-tutorial"})," in the\n",(0,n.jsx)(t.a,{href:"/docs/awel/awel_tutorial/getting_started/1.1_hello_world#creating-a-project",children:"previous chapter"}),"\nand added the ",(0,n.jsx)(t.code,{children:"dbgpt"})," dependency."]}),"\n",(0,n.jsxs)(t.p,{children:["To use the ",(0,n.jsx)(t.code,{children:"HttpTrigger"})," operator, we need to install the ",(0,n.jsx)(t.code,{children:"fastapi"})," and ",(0,n.jsx)(t.code,{children:"uvicorn"})," packages."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"poetry add fastapi uvicorn\n"})}),"\n",(0,n.jsx)(t.p,{children:"The output should look like this:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-plaintext",children:"\u279c  awel-tutorial poetry add fastapi uvicorn\nUsing version ^0.110.0 for fastapi\nUsing version ^0.27.1 for uvicorn\n\nUpdating dependencies\nResolving dependencies... (2.7s)\n\nPackage operations: 7 installs, 0 updates, 0 removals\n\n  \u2022 Installing sniffio (1.3.1)\n  \u2022 Installing anyio (4.3.0)\n  \u2022 Installing click (8.1.7)\n  \u2022 Installing h11 (0.14.0)\n  \u2022 Installing starlette (0.36.3)\n  \u2022 Installing fastapi (0.110.0)\n  \u2022 Installing uvicorn (0.27.1)\n\nWriting lock file\n"})}),"\n",(0,n.jsx)(t.h2,{id:"first-http-trigger",children:"First HTTP Trigger"}),"\n",(0,n.jsxs)(t.p,{children:["Create a new file named ",(0,n.jsx)(t.code,{children:"frist_http_trigger_hello.py"})," in the ",(0,n.jsx)(t.code,{children:"awel_tutorial"})," directory and add the following code:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-python",children:'from dbgpt.core.awel import DAG, HttpTrigger, MapOperator, setup_dev_environment\n\nwith DAG("awel_hello_world") as dag:\n    trigger_task = HttpTrigger(endpoint="/awel_tutorial/hello_world")\n    task = MapOperator(map_function=lambda x: f"Hello, world!")\n    trigger_task >> task  \n    \nsetup_dev_environment([dag], port=5555)\n'})}),"\n",(0,n.jsx)(t.p,{children:"And run the following command to execute the code:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"poetry run python awel_tutorial/frist_http_trigger_hello.py\n"})}),"\n",(0,n.jsx)(t.p,{children:"And the main output should look like this:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-plaintext",children:"2024-03-03 16:26:57 | INFO | dbgpt.core.awel.trigger.http_trigger | Mount http trigger success, path: /api/v1/awel/trigger/awel_tutorial/hello_world\n2024-03-03 16:26:57 | INFO | dbgpt.core.awel.trigger.trigger_manager | Include router <fastapi.routing.APIRouter object at 0x10ed64e50> to prefix path /api/v1/awel/trigger\nINFO:     Started server process [69774]\nINFO:     Waiting for application startup.\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://127.0.0.1:5555 (Press CTRL+C to quit)\n"})}),"\n",(0,n.jsxs)(t.p,{children:["In AWEL, all HTTP endpoints are prefixed with ",(0,n.jsx)(t.code,{children:"/api/v1/awel/trigger"})," by default."]}),"\n",(0,n.jsx)(t.p,{children:"Now, open a new terminal and run the following command to send a request to the server:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"curl -X GET http://127.0.0.1:5555/api/v1/awel/trigger/awel_tutorial/hello_world\n"})}),"\n",(0,n.jsx)(t.p,{children:"The output should look like this:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-plaintext",children:'"Hello, world!"\n'})}),"\n",(0,n.jsx)(t.p,{children:"Congratulations! You have created your first HTTP trigger."}),"\n",(0,n.jsxs)(t.p,{children:["Then you can stop the server by pressing ",(0,n.jsx)(t.code,{children:"Ctrl+C"})," in the terminal."]}),"\n",(0,n.jsx)(t.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,n.jsxs)(t.p,{children:["In above code, we created a ",(0,n.jsx)(t.code,{children:"HttpTrigger"})," operator and a ",(0,n.jsx)(t.code,{children:"MapOperator"})," operator.\n",(0,n.jsx)(t.code,{children:"HttpTrigger"}),' defines the endpoint of the HTTP request, and the method of the request\nis "GET" by default.']}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"setup_dev_environment"})," function is used to start the server and register dags, it\nwill block the main thread if there are ",(0,n.jsx)(t.code,{children:"HttpTrigger"})," operators in the DAG and listen\non 5555 port by default."]}),"\n",(0,n.jsxs)(t.p,{children:["When the server receives a request, it will call the ",(0,n.jsx)(t.code,{children:"MapOperator"})," operator to process\nthe request and return the result."]}),"\n",(0,n.jsxs)(t.p,{children:["In ",(0,n.jsx)(t.code,{children:"HttpTrigger"}),", you can configure the endpoint, method, request body, response body,\nresponse status code, etc."]}),"\n",(0,n.jsxs)(t.p,{children:["In next section, we will introduce more about the ",(0,n.jsx)(t.code,{children:"HttpTrigger"}),"."]})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,t,r)=>{r.d(t,{R:()=>a,x:()=>l});var n=r(6540);const i={},o=n.createContext(i);function a(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);