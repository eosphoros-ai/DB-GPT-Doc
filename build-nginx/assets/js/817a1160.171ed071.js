"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2290],{9828:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>s,default:()=>p,frontMatter:()=>a,metadata:()=>l,toc:()=>d});var r=t(4848),o=t(8453);const a={},s="3.2 Handling GET Requests",l={id:"awel/awel_tutorial/network_program/3.2_http_trigger_get",title:"3.2 Handling GET Requests",description:"In previous section, we created a simple HTTP trigger that returns a fixed string. In",source:"@site/versioned_docs/version-v0.5.0/awel/awel_tutorial/network_program/3.2_http_trigger_get.md",sourceDirName:"awel/awel_tutorial/network_program",slug:"/awel/awel_tutorial/network_program/3.2_http_trigger_get",permalink:"/docs/v0.5.0/awel/awel_tutorial/network_program/3.2_http_trigger_get",draft:!1,unlisted:!1,tags:[],version:"v0.5.0",frontMatter:{},sidebar:"docs",previous:{title:"3.1 Http Trigger",permalink:"/docs/v0.5.0/awel/awel_tutorial/network_program/3.1_http_trigger"},next:{title:"3.3 Handling Post Requests",permalink:"/docs/v0.5.0/awel/awel_tutorial/network_program/3.3_http_trigger_post"}},i={},d=[{value:"Say Hello To Someone",id:"say-hello-to-someone",level:2},{value:"Return JSON Response",id:"return-json-response",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"32-handling-get-requests",children:"3.2 Handling GET Requests"}),"\n",(0,r.jsx)(n.p,{children:"In previous section, we created a simple HTTP trigger that returns a fixed string. In\nthis section, we will create a new HTTP trigger that returns a string based on the\nquery parameters of the request."}),"\n",(0,r.jsx)(n.h2,{id:"say-hello-to-someone",children:"Say Hello To Someone"}),"\n",(0,r.jsxs)(n.p,{children:["Before we start writing the code, we need to install the ",(0,r.jsx)(n.code,{children:"pydantic"})," package in your\nproject ",(0,r.jsx)(n.a,{href:"/docs/awel/awel_tutorial/getting_started/1.1_hello_world#creating-a-projec",children:"awel-tutorial"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'poetry add "pydantic<2,>=1"\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Then create a new file named ",(0,r.jsx)(n.code,{children:"http_trigger_say_hello.py"})," in the ",(0,r.jsx)(n.code,{children:"awel_tutorial"})," directory and add the following code:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from dbgpt._private.pydantic import BaseModel, Field\nfrom dbgpt.core.awel import DAG, HttpTrigger, MapOperator, setup_dev_environment\n\nclass TriggerReqBody(BaseModel):\n    name: str = Field(..., description="User name")\n    age: int = Field(18, description="User age")\n\nwith DAG("awel_say_hello") as dag:\n    trigger_task = HttpTrigger(\n        endpoint="/awel_tutorial/say_hello", \n        methods="GET", \n        request_body=TriggerReqBody,\n        status_code=200\n    )\n    task = MapOperator(\n        map_function=lambda x: f"Hello, {x.name}! You are {x.age} years old."\n    )\n    trigger_task >> task\n\nsetup_dev_environment([dag], port=5555)\n'})}),"\n",(0,r.jsx)(n.p,{children:"And run the following command to execute the code:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"poetry run python awel_tutorial/http_trigger_say_hello.py\n"})}),"\n",(0,r.jsx)(n.p,{children:"Now, open a new terminal and run the following command to send a GET request to the server:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X GET \\\n"http://127.0.0.1:5555/api/v1/awel/trigger/awel_tutorial/say_hello?name=John&age=25"\n'})}),"\n",(0,r.jsx)(n.p,{children:"The output should look like this:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:'"Hello, John! You are 25 years old."\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Then you can stop the server by pressing ",(0,r.jsx)(n.code,{children:"Ctrl+C"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["In above code, we created a ",(0,r.jsx)(n.code,{children:"TriggerReqBody"})," class that inherits from ",(0,r.jsx)(n.code,{children:"BaseModel"})," to\ndefine the structure of the request body. The module ",(0,r.jsx)(n.code,{children:"dbgpt._private.pydantic"})," wraps\nthe pydantic for the compatibility of different versions of pydantic."]}),"\n",(0,r.jsxs)(n.p,{children:["When receiving a request, http trigger will parse the query parameters and build a\n",(0,r.jsx)(n.code,{children:"TriggerReqBody"})," object, then pass it to the next operator."]}),"\n",(0,r.jsx)(n.h2,{id:"return-json-response",children:"Return JSON Response"}),"\n",(0,r.jsx)(n.p,{children:"In previous section, we returned a string as the response. And we can also return a\nJSON response."}),"\n",(0,r.jsxs)(n.p,{children:["AWEL use ",(0,r.jsx)(n.code,{children:"fastapi"})," as the default web framework, and it will automatically judge the\nresponse type of your task output,  common ",(0,r.jsx)(n.code,{children:"dict"}),", ",(0,r.jsx)(n.code,{children:"list"}),", ",(0,r.jsx)(n.code,{children:"BaseModel"})," of ",(0,r.jsx)(n.code,{children:"pydantic"}),",\netc. will be automatically converted to JSON response."]}),"\n",(0,r.jsxs)(n.p,{children:["So if you want to return a JSON response, you can simply return a ",(0,r.jsx)(n.code,{children:"dict"})," or a ",(0,r.jsx)(n.code,{children:"BaseModel"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Create a new file named ",(0,r.jsx)(n.code,{children:"http_trigger_say_hello_json.py"})," in the ",(0,r.jsx)(n.code,{children:"awel_tutorial"})," directory and add the following code:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from dbgpt._private.pydantic import BaseModel, Field\nfrom dbgpt.core.awel import DAG, HttpTrigger, MapOperator, setup_dev_environment\n\nclass TriggerReqBody(BaseModel):\n    name: str = Field(..., description="User name")\n    age: int = Field(18, description="User age")\n\nwith DAG("awel_say_hello_json") as dag:\n    trigger_task = HttpTrigger(\n        endpoint="/awel_tutorial/say_hello_json", \n        methods="GET", \n        request_body=TriggerReqBody,\n    )\n    task = MapOperator(\n        map_function=lambda x: {"message": f"Hello, {x.name}! You are {x.age} years old."}\n    )\n    trigger_task >> task\n\nsetup_dev_environment([dag], port=5555)\n'})}),"\n",(0,r.jsx)(n.p,{children:"And run the following command to execute the code:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"poetry run python awel_tutorial/http_trigger_say_hello_json.py\n"})}),"\n",(0,r.jsx)(n.p,{children:"Now, open a new terminal and run the following command to send a GET request to the server:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X GET \\\n"http://127.0.0.1:5555/api/v1/awel/trigger/awel_tutorial/say_hello_json?name=John&age=25"\n'})}),"\n",(0,r.jsx)(n.p,{children:"And you will get the following output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:'{"message":"Hello, John! You are 25 years old."}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Then you can stop the server by pressing ",(0,r.jsx)(n.code,{children:"Ctrl+C"}),"."]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>l});var r=t(6540);const o={},a=r.createContext(o);function s(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);